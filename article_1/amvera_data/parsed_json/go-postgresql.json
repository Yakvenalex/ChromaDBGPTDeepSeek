{
    "text": "fullstack приложение на go c подключением к postgresql чтобы развернуть основное приложение в amvera нужно выполнить следующие простые шаги 1 открываем страницу https cloud amvera ru projects 2 нажимаем кнопку создать и выбираем тип сервиса приложение 3 выгружаем все файлы можно через git а можно через интерфейс убедитесь что вы выгрузили все нужные файлы для проекта из примера это go mod обязательно go sum обязательно main go обязательно dockerfile обязательно static index html если используете static script js если используете static styles css если используете amvera yml необязательно 4 после этого начнется сборка https docs amvera ru applications build html и развертывание https docs amvera ru applications run html приложения дождитесь появления статуса «успешно развернуто» рассмотрим процесс подробнее видеопример деплоя go приложения eval rst youtube h1ljgk4abhi align center width 100 создадим простое web приложение на языке программирования go где можно будет оставлять и читать цитаты для их хранения будем использовать субд postgresql директория приложения имеет следующую структуру └─ code ├── static │ ├── styles css │ ├── script js │ └── index html ├── amvera yml ├── main go ├── go sum ├── go mod └── dockerfile код статических файлов доступен в конце страницы конфигурация amvera yml написать yaml файл можно как самостоятельно так и воспользоваться нашим генератором yaml перейдя по ссылке https manifest amvera ru либо заполнить в разделе «конфигурация» личного кабинета пример файла amvera yml при использовании только amvera yml meta environment golang toolchain name go version 1 22 build image golang 1 22 run image golang 1 22 persistencemount data containerport 80 пример файла amvera yml при использовании вместе с dockerfile meta environment docker toolchain docker build dockerfile dockerfile skip false run persistencemount data containerport 80 важно сохранять изменяемые файлы база данных и т д именно в постоянное хранилище data это позволит избежать их потери при пересборке папка data в коде и постоянное хранилище data разные директории рассмотрим альтернативный способ задания конфигурации через dockerfile dockerfile замечание если вы используете dockerfile то конфигурационный файл amvera yml в большинстве случаев можно не добавлять шаги 1 создаем dockerfile в директории с проектом 2 в dockerfile указываем базовый образ с названием builder from golang 1 21 1 as builder вместо 1 21 1 можете указать любую другую версию которая вам нужна 3 устанавливаем рабочую директорию workdir app 4 копируем файлы main go go mod и go sum в текущую директорию рабочего каталога copy main go go mod go sum 5 выполняем сборку проекта и создаем исполняемый файл server run cgo enabled 0 go build a installsuffix cgo o server 6 используем образ alpine linux это уменьшит размер конечного образа и улучшит его производительность from alpine latest 7 копируем исполняемый файл server собранный в предыдущем образе в текущую директорию рабочего каталога copy from builder app server 8 копируем статические файлы внутрь контейнера copy static static 9 открываем порт 80 для внешних подключений expose 80 10 добавляем команду для запуска приложения cmd server port 80 получившийся dockerfile from golang 1 21 1 as builder workdir app copy main go go mod go sum run cgo enabled 0 go build a installsuffix cgo o server from alpine latest copy from builder app server copy static static expose 80 cmd server port 80 зависимости go mod и sum go инициализируем новый модуль для управления зависимостями для этого выполняем следующую команду которая создаст файл go mod go mod init main замечание вместо main можно написать произвольную строку остаётся выполнить ещё одну команду которая добавит по две записи на каждую зависимость и создаст файл go sum go mod tidy развертывание субд postgresql базу данных нужно развернуть как отдельное приложение а затем можно будет подключаться к ней из основного приложения подробная инструкция доступна по ссылке https docs amvera ru databases postgresql html postgresql создание проекта в amvera последний шаг развернуть само приложение в файле main go содержится основной код и выполняется подключение к базе данных не забудьте поменять параметры для подключения к базе данных на те которые вы использовали в прошлом шаге при создании базы данных на amvera user имя пользователя password пароль пользователя dbname имя создаваемой бд параметр host можно найти на странице инфо вашего postgresql проекта например amvera username cnpg appname rw main go package main import database sql encoding json log net http strconv github com lib pq укажите те значения которые задавали при создании бд на amvera cloud const host amvera nskripko cnpg godb rw port 5432 user nick password href239 dbname godb func main portstr strconv itoa port dbinfo host host port portstr user user password password dbname dbname sslmode disable db err sql open postgres dbinfo if err nil log fatal err defer db close err db exec create table if not exists quotes id serial primary key quote text not null if err nil log fatal err http handlefunc quotes func w http responsewriter r http request if r method http methodget http error w method not allowed http statusmethodnotallowed return rows err db query select quote from quotes if err nil log println error querying database err http error w internal server error http statusinternalservererror return defer rows close var quotes string for rows next var quote string if err rows scan quote err nil log println error scanning rows err continue quotes append quotes quote json newencoder w encode quotes http handlefunc addquote func w http responsewriter r http request if r method http methodpost http error w method not allowed http statusmethodnotallowed return var data struct quote string json quote if err json newdecoder r body decode data err nil http error w bad request http statusbadrequest return err db exec insert into quotes quote values 1 data quote if err nil log println error inserting quote into database err http error w internal server error http statusinternalservererror return w writeheader http statuscreated fs http fileserver http dir static http handle fs log fatal http listenandserve 80 nil warning код является демонстрационным примером и мы настоятельно не рекомендуем указывать логин и пароль для подключения к базе данных в коде используйте переменные окружения секреты проверка работоспособности 1 переходим в настройки проекта и активируем доменное имя 2 теперь можно перейти по данному url и откроется наше приложение если что то не работает рекомендуем ознакомиться с логами сборки и приложения поздравляем вы успешно создали свое первое приложение в amvera код статических файлов из примера static index html doctype html html lang en head meta charset utf 8 meta name viewport content width device width initial scale 1 0 title quote board title link rel stylesheet href styles css head body div class container h1 quote board h1 form id quoteform input type text id quoteinput placeholder enter your quote required button type submit submit button form div id quotelist div div script src script js script body html static styles css body font family arial sans serif container max width 600px margin 50px auto padding 0 20px input type text width calc 100 80px padding 10px margin right 10px button padding 10px 20px background color 007bff color fff border none cursor pointer button hover background color 0056b3 quotelist margin top 20px static script js document addeventlistener domcontentloaded const quoteform document getelementbyid quoteform const quoteinput document getelementbyid quoteinput const quotelist document getelementbyid quotelist function to fetch quotes from the server and display them const fetchquotes async try const response await fetch quotes const quotes await response json clear previous quotes quotelist innerhtml append new quotes to the list quotes foreach quote const quoteitem document createelement div quoteitem textcontent quote quotelist appendchild quoteitem catch error console error error fetching quotes error fetch initial quotes when the page loads fetchquotes submit quote form quoteform addeventlistener submit async event event preventdefault const newquote quoteinput value trim if newquote alert please enter a quote return try send the new quote to the server await fetch addquote method post headers content type application json body json stringify quote newquote clear the input field quoteinput value fetch and display updated quotes fetchquotes catch error console error error adding quote error eval rst admonition важно class warning сохраняйте файлы бд и иные изменяемые данные в постоянное хранилище чтобы избежать их потери при обновлении проекта когда производится откат папки код до состояния обновления репозитория папка data в корне проекта и директория data это разные директории проверить что сохранение идет в data можно зайдя в папку data на странице репозиторий eval rst admonition важно class warning чтобы избежать ошибки 502 измените в вашем коде host 127 0 0 1 или подобный localhost на 0 0 0 0 и пропишите в конфигурации порт который слушает ваше приложение пример 8080 если у вас не получается развернуть проект напишите наблюдаемую вами симптоматику на support amvera ru с указанием вашего имени пользователя и названия проекта мы постараемся вам помочь",
    "metadata": {
        "file_name": "go-postgresql.md",
        "section_count": 13,
        "section_1": "Fullstack-приложение на Go c подключением к PostgreSQL",
        "section_2": "Видеопример деплоя Go-приложения",
        "section_3": "Создадим простое web приложение на языке программирования Go, где можно будет оставлять и читать цитаты. Для их хранения будем использовать СУБД PostgreSQL.",
        "section_4": "Конфигурация",
        "section_5": "Amvera.yml",
        "section_6": "Dockerfile",
        "section_7": "Шаги:",
        "section_8": "Зависимости (go.mod и sum.go)",
        "section_9": "Развертывание СУБД (PostgreSQL)",
        "section_10": "Создание проекта в Amvera",
        "section_11": " Проверка работоспособности",
        "section_12": "Код статических файлов из примера",
        "section_13": "Если у вас не получается развернуть проект "
    }
}